{% extends "base.html" %}

{% block title %}View Experience - Dengue Journey{% endblock %}

{% block content %}
<div class="container-fluid py-4" style="background: linear-gradient(135deg, #0a2c5c, #499aa8); min-height: 100vh;">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <!-- Header -->
            <div class="text-center mb-4">
                <h1 class="display-6 text-white mb-3">
                    <i class="fas fa-eye me-3"></i>Dengue Experience Details
                </h1>
                <p class="text-light">
                    Detailed view of your dengue journey
                </p>
            </div>

            <!-- Experience Card -->
            <div class="card" style="background: rgba(16, 90, 165, 0.3); border: 1px solid rgba(73, 154, 168, 0.5); box-shadow: 0 8px 32px rgba(0,0,0,0.3);">
                <div class="card-header" style="background: linear-gradient(135deg, #105aa5, #499aa8); color: white;">
                    <div class="d-flex justify-content-between align-items-center">
                        <h4 class="mb-0">
                            {% if experience.experience_type == 'infection' %}
                                <i class="fas fa-virus me-2"></i>Infection Report
                            {% elif experience.experience_type == 'recovery' %}
                                <i class="fas fa-heart me-2"></i>Recovery Update
                            {% else %}
                                <i class="fas fa-edit me-2"></i>Experience Update
                            {% endif %}
                        </h4>
                        <span class="badge 
                            {% if experience.status == 'recovered' %}bg-success
                            {% elif experience.status == 'active' %}bg-danger
                            {% else %}bg-warning{% endif %}">
                            {{ experience.status.title() }}
                        </span>
                    </div>
                </div>
                
                <div class="card-body text-light">
                    <!-- Timeline -->
                    <div class="row mb-4">
                        <div class="col-md-4">
                            <div class="text-center">
                                <i class="fas fa-calendar-plus fa-2x text-info mb-2"></i>
                                <h6>Reported</h6>
                                <p class="small">{{ experience.report_date.strftime('%B %d, %Y') }}</p>
                            </div>
                        </div>
                        {% if experience.infection_date %}
                        <div class="col-md-4">
                            <div class="text-center">
                                <i class="fas fa-virus fa-2x text-danger mb-2"></i>
                                <h6>Infection Date</h6>
                                <p class="small">{{ experience.infection_date.strftime('%B %d, %Y') }}</p>
                            </div>
                        </div>
                        {% endif %}
                        {% if experience.recovery_date %}
                        <div class="col-md-4">
                            <div class="text-center">
                                <i class="fas fa-check-circle fa-2x text-success mb-2"></i>
                                <h6>Recovery Date</h6>
                                <p class="small">{{ experience.recovery_date.strftime('%B %d, %Y') }}</p>
                            </div>
                        </div>
                        {% endif %}
                    </div>

                    <hr>

                    <!-- Experience Details -->
                    <div class="row">
                        <div class="col-md-6">
                            <!-- Severity and Symptoms -->
                            {% if experience.severity_level %}
                            <div class="mb-3">
                                <h6><i class="fas fa-exclamation-triangle me-2"></i>Severity Level</h6>
                                <span class="badge fs-6
                                    {% if experience.severity_level == 'mild' %}bg-success
                                    {% elif experience.severity_level == 'moderate' %}bg-warning
                                    {% elif experience.severity_level == 'severe' %}bg-danger
                                    {% else %}bg-dark{% endif %}">
                                    {{ experience.severity_level.title() }}
                                </span>
                                {% if experience.max_fever_temp %}
                                    <span class="ms-3">
                                        <i class="fas fa-thermometer-half text-danger me-1"></i>
                                        Max Fever: {{ experience.max_fever_temp }}Â°F
                                    </span>
                                {% endif %}
                            </div>
                            {% endif %}

                            {% if experience.symptoms %}
                                {% set symptoms_list = experience.symptoms|from_json %}
                                {% if symptoms_list %}
                                <div class="mb-3">
                                    <h6><i class="fas fa-stethoscope me-2"></i>Symptoms</h6>
                                    <div class="d-flex flex-wrap">
                                        {% for symptom in symptoms_list %}
                                        <span class="badge bg-secondary me-1 mb-1">{{ symptom.replace('_', ' ').title() }}</span>
                                        {% endfor %}
                                    </div>
                                </div>
                                {% endif %}
                            {% endif %}

                            {% if experience.location_infected %}
                            <div class="mb-3">
                                <h6><i class="fas fa-map-marker-alt me-2"></i>Location Infected</h6>
                                <p>{{ experience.location_infected }}</p>
                            </div>
                            {% endif %}
                        </div>

                        <div class="col-md-6">
                            <!-- Medical Care -->
                            <div class="mb-3">
                                <h6><i class="fas fa-user-md me-2"></i>Medical Care</h6>
                                <ul class="list-unstyled">
                                    <li><i class="fas fa-clinic-medical me-2"></i>Doctor Visits: {{ experience.doctor_visits }}</li>
                                    <li>
                                        <i class="fas fa-hospital me-2"></i>Hospitalization: 
                                        {% if experience.hospitalization %}
                                            <span class="text-danger">Yes</span>
                                            {% if experience.hospitalization_days %}
                                                ({{ experience.hospitalization_days }} days)
                                            {% endif %}
                                        {% else %}
                                            <span class="text-success">No</span>
                                        {% endif %}
                                    </li>
                                </ul>
                            </div>

                            {% if experience.treatments_used %}
                                {% set treatments_list = experience.treatments_used|from_json %}
                                {% if treatments_list %}
                                <div class="mb-3">
                                    <h6><i class="fas fa-pills me-2"></i>Treatments Used</h6>
                                    <div class="d-flex flex-wrap">
                                        {% for treatment in treatments_list %}
                                        <span class="badge bg-info me-1 mb-1">{{ treatment.replace('_', ' ').title() }}</span>
                                        {% endfor %}
                                    </div>
                                </div>
                                {% endif %}
                            {% endif %}
                        </div>
                    </div>

                    <hr>

                    <!-- Detailed Information -->
                    {% if experience.circumstances %}
                    <div class="mb-3">
                        <h6><i class="fas fa-question-circle me-2"></i>What Led to Infection?</h6>
                        <p class="text-muted">{{ experience.circumstances }}</p>
                    </div>
                    {% endif %}

                    {% if experience.prevention_used %}
                    <div class="mb-3">
                        <h6><i class="fas fa-shield-alt me-2"></i>Prevention Measures Used</h6>
                        <p class="text-muted">{{ experience.prevention_used }}</p>
                    </div>
                    {% endif %}

                    {% if experience.medications %}
                    <div class="mb-3">
                        <h6><i class="fas fa-prescription-bottle me-2"></i>Medications</h6>
                        <p class="text-muted">{{ experience.medications }}</p>
                    </div>
                    {% endif %}

                    {% if experience.home_remedies %}
                    <div class="mb-3">
                        <h6><i class="fas fa-leaf me-2"></i>Home Remedies</h6>
                        <p class="text-muted">{{ experience.home_remedies }}</p>
                    </div>
                    {% endif %}

                    {% if experience.recovery_notes %}
                    <div class="mb-3">
                        <h6><i class="fas fa-notes-medical me-2"></i>Recovery Progress</h6>
                        <p class="text-muted">{{ experience.recovery_notes }}</p>
                    </div>
                    {% endif %}

                    {% if experience.lessons_learned %}
                    <div class="mb-3">
                        <h6><i class="fas fa-lightbulb me-2"></i>Lessons Learned</h6>
                        <p class="text-muted">{{ experience.lessons_learned }}</p>
                    </div>
                    {% endif %}

                    {% if experience.advice_for_others %}
                    <div class="mb-3">
                        <h6><i class="fas fa-comments me-2"></i>Advice for Others</h6>
                        <div class="alert alert-info">
                            <i class="fas fa-quote-left me-2"></i>{{ experience.advice_for_others }}
                        </div>
                    </div>
                    {% endif %}

                    <hr>

                    <!-- Privacy Info -->
                    <div class="row text-muted small">
                        <div class="col-md-6">
                            <p class="mb-1">
                                <i class="fas fa-user-secret me-1"></i>
                                Anonymous Sharing: 
                                {% if experience.share_anonymously %}
                                    <span class="text-success">Enabled</span>
                                {% else %}
                                    <span class="text-danger">Disabled</span>
                                {% endif %}
                            </p>
                        </div>
                        <div class="col-md-6">
                            <p class="mb-1">
                                <i class="fas fa-globe me-1"></i>
                                Public Story: 
                                {% if experience.public_story %}
                                    <span class="text-success">Enabled</span>
                                {% else %}
                                    <span class="text-danger">Disabled</span>
                                {% endif %}
                            </p>
                        </div>
                    </div>

                    <p class="text-muted small">
                        <i class="fas fa-clock me-1"></i>
                        Last Updated: {{ experience.last_updated.strftime('%B %d, %Y at %I:%M %p') }}
                    </p>

                    <!-- Action Buttons -->
                    <div class="d-flex justify-content-between mt-4">
                        <a href="{{ url_for('dengue_experience') }}" class="btn btn-secondary">
                            <i class="fas fa-arrow-left me-2"></i>Back to Experiences
                        </a>
                        
                        <div>
                            {% if experience.status != 'recovered' %}
                            <a href="{{ url_for('update_experience', experience_id=experience.id) }}" 
                               class="btn btn-success me-2">
                                <i class="fas fa-edit me-2"></i>Update Experience
                            </a>
                            {% endif %}
                            <button class="btn btn-info" onclick="shareExperience()">
                                <i class="fas fa-share me-2"></i>Share
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function shareExperience() {
    if (navigator.share) {
        navigator.share({
            title: 'Dengue Experience - Community Health',
            text: 'Check out this dengue experience shared to help our community understand and prevent dengue.',
            url: window.location.href
        });
    } else {
        // Fallback - copy to clipboard
        navigator.clipboard.writeText(window.location.href).then(function() {
            alert('Experience link copied to clipboard!');
        });
    }
}
</script>
{% endblock %}